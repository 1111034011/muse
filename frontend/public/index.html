<!DOCTYPE html>
<html lang="zh-TW">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MUSIC音樂</title>
    <link rel="stylesheet" href="css/back.css">
    <link rel="stylesheet" href="css/Backstage.css">
    <link rel="stylesheet" href="css/song.css" media="all">
    <link rel="stylesheet" href="css/index.css" media="all">
    <link rel="stylesheet" href="css/top.css" media="all">
    <script src="js/front_side.js"></script>

</head>

<body>
    <div class="setbody">
        <div class="sidebar-toggle" onclick="toggleSidebar()">☰</div>

        <!-- 這個 div 用來插入側邊欄 -->
        <div id="sidebar-container"></div>
        <div class="main">
            <!-- <div class="title">
                <div class="left"></div>
                <h2 class="titleh2">MUSE</h2><a href="user.html" class="title-user">
                    <span class="icon-holder">
                        <svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" fill="currentColor"
                            class="bi bi-person-fill" viewBox="0 0 16 16">
                            <path d="M3 14s-1 0-1-1 1-4 6-4 6 3 6 4-1 1-1 1zm5-6a3 3 0 1 0 0-6 3 3 0 0 0 0 6" />
                        </svg>
                    </span>
                </a>
            </div> -->
            <div class="title">
                <h2 class="titleh2">MUSE</h2>
            </div>
            <!-- 內容區域 -->
            <main id="contents" style="width:auto;">
                <div class="top">
                    <div class="slider">
                        <div class="slide"><img src="img/1.webp" alt="唱片1"></div>
                        <div class="slide"><img src="img/1.webp" alt="唱片2"></div>
                        <div class="slide"><img src="img/1.webp" alt="唱片3"></div>
                    </div>
                </div>

                <!-- 搜尋欄位 -->
                <div class="search-bar">
                    <input type="text" placeholder="搜尋" id="searchInput">
                    <button onclick="window.location.href='ranking.html'">
                        <img src="img/Search 02.png" alt="搜尋">
                    </button>

                </div>

                <!-- 歌曲區域 -->
                <div class="song">
                    <div class="hot">
                        <h2>今日熱門</h2>
                        <ul>
                            <li>
                                <a href="music.html">
                                    <div class="songs" id="musicContainer">
                                        <div class="songco">
                                            ROCKSTAR<br>
                                            <span>LISA </span><br>
                                            <span>流行</span>
                                        </div>
                                        <button class="songtags">加入歌單</button>
                                    </div>
                                </a>
                            </li>
                            <li>
                                <a href="music.html">
                                    <div class="songs">
                                        <div class="songco">
                                            Really Like You<br>
                                            <span>BABYMONSTER </span><br>
                                            <span>流行</span>
                                        </div>
                                        <button class="songtags">加入歌單</button>
                                    </div>
                                </a>
                            </li>

                            <li>
                                <a href="music.html">
                                    <div class="songs">
                                        <div class="songco">
                                            Strategy<br>
                                            <span>TWICE </span><br>
                                            <span>流行</span>
                                        </div>
                                        <button class="songtags">加入歌單</button>
                                    </div>
                                </a>
                            </li>
                        </ul>
                    </div>

                    <div class="persontt">
                        <h2>今日熱門2</h2>
                        <ul>
                            <li>
                                <a href="music.html">
                                    <div class="songs">
                                        <div class="songco">
                                            玫瑰少年<br>
                                            <span>蔡依林 </span><br>
                                            <span>流行</span>
                                        </div>
                                        <button class="songtags">加入歌單</button>
                                    </div>
                                </a>
                            </li>
                            <li>
                                <a href="music.html">
                                    <div class="songs">
                                        <div class="songco">
                                            錯過的煙火<br>
                                            <span>周杰倫 </span><br>
                                            <span>抒情搖滾</span>
                                        </div>
                                        <button class="songtags">加入歌單</button>
                                    </div>
                                </a>
                            </li>
                            <li>
                                <a href="music.html">
                                    <div class="songs">
                                        <div class="songco">
                                            怎麼了<br>
                                            <span>周興哲</span><br>
                                            <span>抒情</span>
                                        </div>
                                        <button class="songtags">加入歌單</button>
                                    </div>
                                </a>
                            </li>
                        </ul>
                    </div>
                </div>
            </main>
        </div>
    </div>
</body>

<script>
    const token = localStorage.getItem('token');

    const member_data = async () => {
        try {
            const response = await fetch("http://localhost:8000/api/Backstage/musiclist", {
                method: 'GET',
                headers: {
                    'Authorization': 'Bearer ' + token,
                    'Content-Type': 'application/json',
                },
            });

            const data = await response.json();
            console.log("API 回傳的物件：", data);

            if (data && data.success && Array.isArray(data.music)) {
                renderSongList(data.music);
            } else {
                console.error("API 返回的數據格式不符合預期:", data);
            }

            return data;
        } catch (error) {
            console.error("錯誤：", error);
        }
    };

    function renderSongList(musicData) {
        if (!Array.isArray(musicData) || musicData.length === 0) {
            console.error("沒有歌曲數據可以呈現");
            return;
        }

        const hotSongsList = document.querySelector('.hot ul');
        hotSongsList.innerHTML = ''; 

        const hotSongs = musicData.slice(0, Math.min(3, musicData.length));

        hotSongs.forEach(music => {
            const listItem = document.createElement('li');
            listItem.innerHTML = `
            <a href="music.html?id=${music.Music_ID || ''}">
                <div class="songs">
                    <div class="songco">
                        ${music.Music_Name}<br>
                        <span>${music.Artist}</span><br>
                        <span>${music.Tag_Name || '流行'}</span>
                    </div>
                    <button class="songtags" onclick="addToPlaylist(event, ${music.Music_ID})">加入歌單</button>
                </div>
            </a>
        `;
            hotSongsList.appendChild(listItem);
        });

        const personalSongsList = document.querySelector('.persontt ul');
        personalSongsList.innerHTML = ''; 

        let personalSongs = [];
        if (musicData.length > 3) {
            personalSongs = musicData.slice(3, 6); 
        } else {
            personalSongs = musicData.slice(0, Math.min(3, musicData.length)); 
        }

        personalSongs.forEach(music => {
            const listItem = document.createElement('li');
            listItem.innerHTML = `
            <a href="music.html?id=${music.Music_ID || ''}">
                <div class="songs">
                    <div class="songco">
                        ${music.Music_Name}<br>
                        <span>${music.Artist}</span><br>
                        <span>${music.Tag_Name || '流行'}</span>
                    </div>
                    <button class="songtags" onclick="addToPlaylist(event, ${music.Music_ID})">加入歌單</button>
                </div>
            </a>
        `;
            personalSongsList.appendChild(listItem);
        });

        console.log(`已渲染共 ${hotSongs.length + personalSongs.length} 首歌曲到頁面`);
    }

    // 加入歌單功能
    function addToPlaylist(event, musicId) {
        event.preventDefault(); 
        event.stopPropagation(); 

        // 這裡添加將歌曲加入歌單的邏輯
        console.log(`將音樂 ID: ${musicId} 加入歌單`);

        // 如果有API可以呼叫，可以在這裡添加
        // addToPlaylistAPI(musicId);

        alert(`已將歌曲加入歌單！`);
    }

    document.addEventListener('DOMContentLoaded', () => {
        member_data();
    });
</script>

</html>