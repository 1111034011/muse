<!DOCTYPE html>
<html lang="zh-Hant">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>MB後台總覽</title>
  <link rel="stylesheet" href="css/back.css">
  <link rel="stylesheet" href="css/Backstage.css">
  <link rel="stylesheet" href="../RWD.css">
  <script src="js/side.js"></script>
</head>

<body>
  <div class="sidebar-toggle" onclick="toggleSidebar()">☰</div>

  <!-- 這個 div 用來插入側邊欄 -->
  <div id="sidebar-container"></div>

  <!-- 主內容區 -->
  <div class="main">
    <div class="search-bar">
      <div class="search-container">
        <input type="text" placeholder="搜尋" id="search-input" />
        <button id="search-button" class="search-btn">
          <img src="img/Search 02.png" alt="搜尋" />
        </button>
      </div>
    </div>

    <div class="dashboard-cards">
      <div class="card">
        <h3>歌曲數量</h3>
        <p>3</p>
      </div>
      <div class="card">
        <h3>用戶數</h3>
        <p>25</p>
      </div>
    </div>

    <div class="hot-section">
      <h3>本月熱門</h3>
      <div class="hot-tracks">
        <div class="hot-track" onclick="location.href='#'">第一名歌曲</div>
        <div class="hot-track" onclick="location.href='#'">第二名歌曲</div>
        <div class="hot-track" onclick="location.href='#'">第三名歌曲</div>
      </div>
    </div>
  </div>
</body>

<script>
  const token = localStorage.getItem('token');

  const member_data = async () => {
    try {
      const response = await fetch("http://localhost:8000/api/Backstage/musiclist", {
        method: 'GET',
        headers: {
          'Authorization': 'Bearer ' + token,
          'Content-Type': 'application/json',
        },
      });

      const data = await response.json();
      console.log("API 回傳的物件：", data);

      if (data && data.success && Array.isArray(data.music)) {
        renderHotTracks(data.music); // 呼叫新的渲染函式
      } else {
        console.error("API 返回的數據格式不符合預期:", data);
      }

      return data;
    } catch (error) {
      console.error("錯誤：", error);
    }
  };

  function renderHotTracks(musicData) {
    if (!Array.isArray(musicData) || musicData.length === 0) {
      console.error("沒有歌曲數據可以呈現");
      return;
    }

    const hotTracksContainer = document.querySelector('.hot-tracks');
    hotTracksContainer.innerHTML = ''; // 清空原本的假資料

    const topThreeSongs = musicData.slice(0, 3);

    topThreeSongs.forEach((song, index) => {
      const trackDiv = document.createElement('div');
      trackDiv.className = 'hot-track';
      trackDiv.innerHTML = `<strong>Top ${index + 1}</strong> - ${song.Music_Name || `第${index + 1}名歌曲`}`;
      trackDiv.onclick = () => {
        location.href = `music.html?id=${song.Music_ID}`;
      };
      hotTracksContainer.appendChild(trackDiv);
    });

    console.log(`已更新前${topThreeSongs.length}首熱門歌曲`);
  }

  document.addEventListener('DOMContentLoaded', () => {
    member_data();
  });
</script>


</html>